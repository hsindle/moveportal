{% extends "base.html" %}
{% load crispy_forms_tags %} 
{% load static %}

{% block title %}Edit User: {{ user_to_edit.username }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">✍️ Edit Staff User: {{ user_to_edit.get_full_name }}</h1>

    <div class="p-6 bg-white shadow-xl rounded-lg border-t-4 border-indigo-600 mb-6">
        <h2 class="text-xl font-semibold mb-4 text-indigo-700">Account and Role</h2>
        <form method="post">
            {% csrf_token %}
            
            {{ form|crispy }}
            
            <p class="text-sm text-gray-600 mt-4 mb-4">Note: Passwords must be changed using the Django Admin site for security.</p>

            <div class="flex justify-between items-center mt-6 pt-4 border-t border-gray-200">
                <button type="submit" 
                        class="py-2 px-4 rounded-md text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 transition">
                    Save Changes
                </button>
                
                <a href="{% url 'manager_delete_user' user_to_edit.id %}" 
                   class="py-2 px-4 rounded-md text-sm font-medium text-white bg-red-600 hover:bg-red-700 transition shadow-md">
                    Delete User
                </a>
            </div>
        </form>
    </div>
    
    <div class="p-6 bg-white shadow-xl rounded-lg border-t-4 border-success">
        <h2 class="text-xl font-semibold mb-4 text-green-700">HR & Compliance Submissions</h2>
        
        {% if onboarding_doc %}
        <dl class="space-y-3">
            <h3 class="font-bold text-md border-b pb-2 mb-2">Onboarding Status: 
                <span class="text-green-600">Complete</span> (Submitted {{ onboarding_doc.date_submitted|date:"M j, Y" }})
            </h3>
            
            <div>
                <dt class="font-medium text-gray-700">Bank Details</dt>
                <dd class="ml-4 text-sm text-gray-900">Account Holder: {{ onboarding_doc.account_holder_name }}</dd>
                <dd class="ml-4 text-sm text-gray-900">Sort Code: {{ onboarding_doc.sort_code }} | Account No: {{ onboarding_doc.account_number }}</dd>
            </div>
            
            <div>
                <dt class="font-medium text-gray-700">Emergency Contact</dt>
                <dd class="ml-4 text-sm text-gray-900">{{ onboarding_doc.emergency_contact_name }} ({{ onboarding_doc.emergency_contact_phone }})</dd>
            </div>
            
            <div class="pt-2 border-t mt-4">
                <dt class="font-medium text-gray-700">Documents</dt>
                <dd class="ml-4 text-sm">
                    <strong>Right to Work:</strong> 
                    <a href="{{ onboarding_doc.right_to_work_proof.url }}" target="_blank" class="text-blue-600 hover:underline">View Proof</a>
                </dd>
                <dd class="ml-4 text-sm">
                    <strong>P45:</strong> 
                    {% if onboarding_doc.p45_document %}
                        <a href="{{ onboarding_doc.p45_document.url }}" target="_blank" class="text-blue-600 hover:underline">View P45</a>
                    {% else %}
                        N/A
                    {% endif %}
                </dd>
            </div>

        </dl>
        {% else %}
            <p class="text-red-500 font-medium">Onboarding Document is missing or incomplete.</p>
        {% endif %}
    </div>


    <div class="mt-6">
        <a href="{% url 'manager_user_list' %}" 
           class="inline-block px-4 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 transition">
            ← Back to User List
        </a>
    </div>
</div>
{% endblock %}