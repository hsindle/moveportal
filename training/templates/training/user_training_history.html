{% extends "base.html" %}

{% block title %}Training History ‚Äî {{ target_user.get_full_name }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">
        üìö Training Records for {{ target_user.get_full_name }}
    </h1>
    <p class="text-sm text-gray-600 mb-6">Username: {{ target_user.username }}</p>

    <div class="bg-white shadow-xl rounded-lg overflow-hidden">
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Course</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Last Passed</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Score</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Renewal Due</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for data in attempts %}
                    <tr class="hover:bg-gray-50">
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">{{ data.course.title }}</td>
                        
                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ data.last_completed|date:"M j, Y"|default:"Never" }}
                        </td>

                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                            {{ data.score|default:"‚Äî" }}{% if data.score is not None %}%{% endif %}
                        </td>

                        <td class="px-6 py-4 whitespace-nowrap">
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full 
                                {% if data.is_completed %} bg-green-100 text-green-800
                                {% elif data.last_completed %} bg-red-100 text-red-800
                                {% else %} bg-yellow-100 text-yellow-800 {% endif %}">
                                
                                {% if data.is_completed %}
                                    Completed
                                {% elif data.last_completed %}
                                    Expired / Failed
                                {% else %}
                                    Required
                                {% endif %}
                            </span>
                        </td>
                        
                        <td class="px-6 py-4 whitespace-nowrap text-sm font-medium 
                            {% if data.renewal_due_date and not data.is_completed %} text-red-700 font-bold {% endif %}">
                            {% if data.course.is_recurring %}
                                {{ data.renewal_due_date|date:"M j, Y"|default:"N/A" }}
                            {% else %}
                                N/A
                            {% endif %}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="5" class="text-center py-4 text-gray-500">No required courses defined for this user's roles.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    
    <div class="mt-6">
        <a href="{% url 'manager_user_list' %}" class="inline-block px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition">
            ‚Üê Back to User List
        </a>
    </div>
</div>
{% endblock %}