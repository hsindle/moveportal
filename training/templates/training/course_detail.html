{% extends "base.html" %}

{% block title %}{{ course.title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto py-8">
    <h1 class="text-3xl font-bold mb-6 text-gray-800">Module: {{ course.title }}</h1>
    
    <div class="space-y-6">
        
        <div class="bg-white p-6 rounded-xl shadow-lg">
            <h2 class="text-xl font-semibold mb-3">Training Content</h2>
            
            {% if course.video_url %}
            <div class="relative overflow-hidden w-full rounded-lg">
                <iframe id="training-video-iframe"
                        class="w-full h-96" 
                        src="{{ course.video_url }}" 
                        frameborder="0" 
                        allowfullscreen 
                        allow="autoplay; encrypted-media">
                </iframe>
            </div>
            
            {% else %}
            <div class="p-6 text-center text-gray-500 border border-dashed rounded-lg">
                Video content link is missing.
            </div>
            {% endif %}
            
            <p class="mt-4 text-gray-600">{{ course.description|default:"No module description provided." }}</p>
        </div>
        
        <div class="bg-yellow-50 p-6 rounded-xl shadow-lg border-t-4 border-yellow-600">
            <h2 class="text-xl font-semibold mb-3 text-yellow-800">Quiz Requirement</h2>
            <p class="text-gray-700 mb-4">
                You must finish the training content before proceeding to the quiz.
            </p>
            
            <a id="quiz-button" href="{% url 'training:course_start' course.id %}" 
               class="px-6 py-3 bg-gray-400 text-white font-bold rounded-lg transition shadow-lg pointer-events-none">
                Proceed to Quiz ‚Üí
            </a>
        </div>
        
    </div>
    
    <div class="mt-6">
        <a href="{% url 'training:training_dashboard' %}" class="inline-block px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition">
            ‚Üê Back to Training Dashboard
        </a>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var videoIframe = document.getElementById('training-video-iframe');
        var quizButton = document.getElementById('quiz-button');
        
        if (videoIframe && quizButton) {
            
            // üö® FIX 4: SIMPLE TIMEOUT / MOCK COMPLETION FOR MVP üö®
            // Since tracking full video playback across iframe security boundaries is difficult,
            // we will enable the button after a short delay (simulating content loading/viewing).
            // NOTE: For true compliance, you'd need the YouTube/Vimeo JS API which is complex.
            
            console.log("Video loading. Quiz button disabled.");
            
            // Enable the button after 3 seconds (simulating user viewing instructions)
            setTimeout(function() {
                quizButton.classList.remove('bg-gray-400', 'pointer-events-none');
                quizButton.classList.add('bg-red-600', 'hover:bg-red-700');
                console.log("Quiz button enabled.");
            }, 3000); 
            
            // If you later integrate the YouTube API, the onStateChange event would replace this timeout.
        }
    });
</script>
{% endblock %}